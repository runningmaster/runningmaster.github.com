<!DOCTYPE html>
<html lang="ru">

<head>
 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	<title>runningmaster's githublog : Morion Web Services API (Draft)</title>
 	<link rel="stylesheet" href="./src/dsgn.css" type="text/css" media="screen, projection" />
 	<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" />
 	<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" />
 	<link href="/img/favicon.png" rel="icon" />
 	<link rel="alternate" title="runningmaster's githublog" href="/feed.xml" type="application/atom+xml">
 	<!--
 	<link rel="stylesheet" type="text/css" href="/css/highlight.css" />
 	-->
 	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-31528830-1']);
		_gaq.push(['_trackPageview']);
		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>  
</head>

<body>
	<a href="http://runningmaster.github.com/" title="Home" id="img_logo"></a>
	<a href="http://github.com/runningmaster/" title="Fork me on GitHub" id="img_fork"></a>
	<a href="/feed.xml" title="Feed" id="img_feed"></a>
	<a href="mailto:runningmaster@gmail.com" title="Mail" id="img_mail"></a>
 	<div class="site">
		<div class="menu">
			<a href=".">home</a> | 
			<a href="./ubuntu.html">ubuntu</a> | 
			<a href="./about.html">about</a>
		</div>
		<div id="home">
			
			<div class="title"> 
				page
			</div>
			<h1>Morion Web Services API (Draft)</h1>
			<div id="post">
				<p><em>документ постоянно обновляется</em></p>

<h2>Соглашения</h2>

<p>Данные передаются по протоколу <a href="http://ru.wikipedia.org/wiki/HTTPS">HTTPS</a>, поддерживающий шифрование. На текущий момент времени сертификат сервера самодписанный и игнорируется клиентом.</p>

<ol>
<li><p>API реализуется двумя HTTP методами:</p>

<ul>
<li><code>GET</code> - для получения данных из сервиса в теле ответа на запрос</li>
<li><code>POST</code> - для передачи данных в сервис в теле запроса</li>
</ul></li>

<li><p>API идентификация реализуется через параметры методов:</p>

<ul>
<li><code>auth</code> (string) - выдается при регистрации клиента и идентифицирует его</li>
<li><code>pass</code> (string) - рассчитывается по одинаковому алгоритму (как на стороне клиента, так и на стороне сервера) на основе секретного ключа, уникального для каждого клиента</li>
</ul>

<p><code>GET</code> <code>&lt;auth_params&gt; =&gt; auth=public_key&amp;pass=sha1(secret_key+public_key)</code></p>

<p><code>POST</code> <code>&lt;auth_params&gt; =&gt; auth=public_key&amp;pass=sha1(secret_key+post_data)</code></p></li>

<li><p>API определяется следующим общим url-форматом:</p>

<pre><code>https://api.{domain}/{service+version}/{aspect}/{action}[?&lt;authparams&gt;&amp;key=value&amp;...]
</code></pre></li>

<li><p>API предпочитает формат данных <code>application/json</code> (см. <a href="http://json.org/">JSON</a>), как для приема, так и для передачи данных. В специальных же случаях может быть оговорен другой тип (см. <a href="http://en.wikipedia.org/wiki/Mime_type">Content-Type</a>), например, <code>text/csv</code> для исторической поддержки определенного вида информации.</p></li>
</ol>

<h2>Linkdroid API</h2>

<p>Облачный сервис распознавания входящих данных различного типа в реальном режиме времени. Нераспознанные названия отсылает в сервис экспертной системы для последующей их привязки к значениям ключей эталонных справочников. Распознанные названия вместе с их атрибутами отсылает для последующей обработки в соотвествующие сервисы.</p>

<h3>Аутентификация - auth (private)</h3>

<ul>
<li><p><strong>Создание/обновление аутентификации:</strong> <code>/ld1/auth/set</code></p>

<p>Создает или обновляет аутентификацию как пару хеш-ключей - публичного <code>pkey</code> (string) и секретного <code>skey</code> (string):</p>

<pre><code>POST https://api.morion.ua/ld1/auth/set?auth=1243b7cd&amp;pass=811ede49 HTTP/1.1
Content-Type: application/json


{
    &quot;pkey&quot;: &quot;ad0f7b32c41f311160db30fd2dc5f9f913f0aa41&quot;,
    &quot;skey&quot;: &quot;f01fd7eb1485290c10b1ac95db9710670f89bda6&quot;
}
</code></pre></li>

<li><p><strong>Удаление аутентификации:</strong> <code>/ld1/auth/del</code></p>

<p>Удаляет аутентификацию по публичному ключу <code>pkey</code> (string):</p>

<pre><code>POST https://api.morion.ua/ld1/auth/del?auth=1243b7cd&amp;pass=811ede49 HTTP/1.1
Content-Type: application/json


{
    &quot;pkey&quot;: &quot;ad0f7b32c41f311160db30fd2dc5f9f913f0aa41&quot;
}
</code></pre></li>
</ul>

<h3>Входящие данные - data (public)</h3>

<ul>
<li><p><strong>Прием данных по их типу:</strong> <code>/ld1/data/add</code></p>

<p>Принимает данные из различных источников. Формат и логика их последующей обработки зависит от параметра <code>type</code>, который задается разработчиками сервиса для каждого отдельного случая.</p>

<p><code>type=720fc5af</code> - например, чек из аптеки в <code>json</code>:</p>

<pre><code>POST https://api.morion.ua/ld1/data/add?auth=1243b7cd&amp;pass=811ede49&amp;type=720fc5af HTTP/1.1
Content-Type: application/json


{
    &quot;id&quot;: 403,
    &quot;name&quot;: &quot;one&quot;,
    &quot;quant&quot;: 1,
    &quot;price&quot;: 0.5
}
</code></pre>

<p><code>type=1a383386</code> - что-то еще, например прайс-лист в <code>csv</code>:</p>

<pre><code>POST https://api.morion.ua/ld1/data/add?auth=1243b7cd&amp;pass=811ede49&amp;type=1a383386 HTTP/1.1
Content-Type: text/csv


blah;blah;blah;blah;blah;
blah;blah;blah;blah;blah;
blah;blah;blah;blah;blah;
blah;blah;blah;blah;blah;
blah;blah;blah;blah;blah;
</code></pre>

<p><code>type=e17370c5</code> - или же можно принимать <code>xmmo</code>:</p>

<pre><code>POST https://api.morion.ua/ld1/data/add?auth=1243b7cd&amp;pass=811ede49&amp;type=e17370c5 HTTP/1.1
Content-Type: text/xml


&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;ElOrder&gt; 
    &lt;Document DocType=&quot;РасходнаяНакладная&quot; Version=&quot;1&quot; DivType=&quot; Простые &quot;&gt;
        &lt;Header&gt; 
        &lt;/Header&gt; 
        &lt;Body&gt;
            &lt;Items&gt;
            &lt;/Items&gt;
        &lt;/Body&gt; 
    &lt;/Document&gt; 
&lt;/ElOrder&gt; 
</code></pre></li>
</ul>

<h3>Связь - link (private)</h3>

<ul>
<li><p><strong>Создание/обновление связи:</strong> <code>/ld1/link/set</code></p>

<p>Устанавливает для контрольной суммы <code>sha</code> (string) ссылку на новое значение эталонного ключа <code>new</code> (Int64):</p>

<pre><code>POST https://api.morion.ua/ld1/link/set?auth=1243b7cd&amp;pass=811ede49 HTTP/1.1
Content-Type: application/json


{
    &quot;sha&quot;: &quot;7c0e9591ff9b00f397718a63ae17370c566d4ca8&quot;,
    &quot;new&quot;: 5577006791947779410
}
</code></pre></li>

<li><p><strong>Удаление связи:</strong> <code>/ld1/link/del</code></p>

<p>Удаляет ссылку для контрольной суммы <code>sha</code> (string):</p>

<pre><code>POST https://api.morion.ua/ld1/link/del?auth=1243b7cd&amp;pass=811ede49 HTTP/1.1
Content-Type: application/json


{
    &quot;sha&quot;: &quot;97c01ac379ab5c9019a2fff10de32ecb36abae53&quot;
}
</code></pre></li>

<li><p><strong>Переназначение связей:</strong> <code>/ld1/link/sets</code></p>

<p>Обновляет все ссылки на эталонный ключ <code>old</code> (Int64) на его новое значение <code>id_new</code> (Int64):</p>

<pre><code>POST https://api.morion.ua/ld1/link/sets?auth=1243b7cd&amp;pass=811ede49 HTTP/1.1
Content-Type: application/json


{
    &quot;old&quot;: 5577006791947779410,
    &quot;new&quot;: 4039410712379194777
}
</code></pre></li>

<li><p><strong>Удаление связей:</strong> <code>/ld1/link/dels</code></p>

<p>Удаляет все ссылки на эталонный ключ <code>old</code> (Int64):</p>

<pre><code>POST https://api.morion.ua/ld1/link/dels?auth=1243b7cd&amp;pass=811ede49 HTTP/1.1
Content-Type: application/json


{
    &quot;old&quot;: 4039410712379194777
}
</code></pre></li>
</ul>

			</div>
			
			<div class="footer">
				<div class="contact">
					&copy; 2012
					<a href="mailto:runningmaster@gmail.com" title="Написать письмо">Dmitriy Kovalenko</a> | <a href="/feed.xml" rel="subscribe-rss" title="Подписаться через RSS">RSS</a> | <a href="http://github.com/runningmaster/runningmaster.github.com/blob/master/src/main.go" title="Посмотреть код">Made on Go</a>
				</div>
			</div>

		</div>
	</div>
</body>

</html>